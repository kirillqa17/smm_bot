import re

def escape_markdown_v2(text):
    """
    Экранирует специальные символы в тексте для использования с parse_mode='MarkdownV2' в Telegram API.
    Список специальных символов: _ * [ ] ( ) ~ ` > # + - = | { } . !
    Эти символы должны быть экранированы с помощью обратного слэша '\'
    если они не используются для форматирования.
    """
    # Символы, которые необходимо экранировать в MarkdownV2.
    # Порядок имеет значение для некоторых символов (например, '.').
    # Источник: https://core.telegram.org/bots/api#markdownv2-style
    escape_chars = r'_*[]()~`>#+-=|{}.!'
    # Используем re.sub для замены каждого специального символа на экранированный.
    # r'\\\1' означает: обратный слэш, затем сам найденный символ.
    return re.sub(f'([{re.escape(escape_chars)}])', r'\\\1', text)

